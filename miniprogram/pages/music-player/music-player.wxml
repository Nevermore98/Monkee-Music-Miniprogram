<!-- pages/music-player/music-player.wxml -->
<wxs src="../../utils/format.wxs" module="format" />
<!-- 背景图片以及遮罩层 -->
<image class="image-blur" src="{{currentSong.al.picUrl}}" mode="aspectFill"></image>
<view class="mask"></view>
<!-- 导航栏 -->
<nav-bar>
  <view class="nav-bar-tabs" slot="center">
    <block wx:for="{{navBarTitles}}" wx:key="*this">
      <view bindtap="onNavBarItemTap" data-index="{{index}}" class="item {{currentPage === index ? 'active' : ''}}">
        {{item}}
      </view>
      <view class="divider" wx:if="{{index !== navBarTitles.length - 1}}">|</view>
    </block>
  </view>
</nav-bar>
<!-- 歌曲与歌词滑动页 -->
<swiper style="height: {{swiperHeight}}px;" bindchange="onSwiperChange" current="{{currentPage}}">
  <swiper-item class="song-page">
    <image class="song-cover" src="{{currentSong.al.picUrl}}" mode="widthFix" />
    <view class="song-info">
      <view class="song-name">{{currentSong.name}}</view>
      <view class="song-artist">{{formattedArtist}}</view>
    </view>
    <view class="line-lyric">{{currentLyricText}}</view>
    <view class="song-control">
      <view class="progress">
        <van-slider class="slider {{isSliderDragging ? 'dragging' : ''}}" step="{{0.1}}" value="{{sliderValue}}" bind:change="onSliderChange" bind:drag="onSliderDragging" bar-height="5px" />
        <view class="time">
          <view class="time-current">{{format.formatTime(currentTime)}}</view>
          <view class="time-duration">{{format.formatTime(durationTime)}}</view>
        </view>
      </view>
      <view class="btns">
        <view class="icomoon icon-list"></view>
        <view class="icomoon icon-last"></view>
        <view bindtap="onPlayOrPauseTap" class="btn-play icomoon icon-{{isPlaying ? 'BiPauseCircle' : 'BiPlayCircle'}}"></view>
        <view class="icomoon icon-next"></view>
        <view class="icomoon icon-MdiPlaylistMusic"></view>
      </view>
    </view>
  </swiper-item>
  <swiper-item class="lyric-page">
    <scroll-view class="lyric-list" scroll-y scroll-top="{{lyricScrollTop}}rpx" scroll-with-animation enable-passive>
      <block wx:for="{{lyricInfos}}" wx:key="lineTime">
        <view bindtap="onLyricItemTap" data-index="{{index}}" class="lyric-item {{currentLyricIndex === index ? 'current-active': ''}} {{tapLyricIndex === index ? 'tap-active': ''}}" style="margin-top: {{index === 0 ? (swiperHeight/2-80) : 0}}px;">
          {{item.text}}
        </view>
      </block>
      <!-- 最后一个子元素的 margin-bottom 失效，使用一个元素占位 -->
      <view style="height: {{(swiperHeight/2-100)}}px;}}"></view>
    </scroll-view>
    <view class="lyric-control">
      <!-- TODO 更换图标 -->
      <view bindtap="onPlayOrPauseTap" class="btn-play icomoon icon-{{isPlaying ? 'BiPauseCircle' : 'Fa6SolidCirclePlay'}}"></view>
    </view>
  </swiper-item>
</swiper>
